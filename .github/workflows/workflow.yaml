name: Python Application

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest  # Continue using the latest Ubuntu available

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    # Manually install Python 3.9.6 by compiling from source
    - name: Install Python 3.9.6 from source
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          wget \
          build-essential \
          libssl-dev \
          zlib1g-dev \
          libncurses5-dev \
          libncursesw5-dev \
          libreadline-dev \
          libsqlite3-dev \
          libgdbm-dev \
          libdb5.3-dev \
          libbz2-dev \
          libexpat1-dev \
          liblzma-dev \
          tk-dev \
          libffi-dev \
          uuid-dev

        # Download Python 3.9.6 source code
        wget https://www.python.org/ftp/python/3.9.6/Python-3.9.6.tgz
        tar -xf Python-3.9.6.tgz
        cd Python-3.9.6

        # Configure and build Python
        ./configure --enable-optimizations
        make -j$(nproc)
        sudo make altinstall  # Avoid replacing the system python

        # Check the installed Python version
        python3.9 --version

    - name: Set up Python 3.9.6
      run: |
        sudo update-alternatives --install /usr/bin/python3 python3 /usr/local/bin/python3.9 1
        sudo update-alternatives --set python3 /usr/local/bin/python3.9
        python3 --version

    - name: Install pip for Python 3.9.6
      run: |
        curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
        python3.9 get-pip.py
        python3.9 -m pip --version

    - name: Install dependencies
      run: python3.9 -m pip install -r requirements.txt

    - name: Run your Python script
      run: python3.9 run_chsh_inequality.py
